name: "Ubuntu images check"

on:
  workflow_dispatch:

jobs:
  testing:
    name: Testing
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ ubuntu-18.04, ubuntu-20.04 ]
    steps:
      - uses: actions/checkout@v2
        with:
          submodules: true

      - name: Check execution
        shell: bash
        run: |
          for version in $("2.1","3.1","5.0","6.0"); do
            release_url="https://dotnetcli.blob.core.windows.net/dotnet/release-metadata/${version}/releases.json"
            download_with_retries "${release_url}" "." "${version}.json"
            releases=$(cat "./${version}.json")
            if [[ $version == "6.0" ]]; then
                sdks=("${sdks[@]}" $(echo "${releases}" | jq '.releases[]' | jq '.sdks[]?' | jq '.version' | grep -v preview | grep -v rc | grep -v display)[0])
            else
                sdks=("${sdks[@]}" $(echo "${releases}" | jq '.releases[]' | jq '.sdks[]?' | jq '.version' | grep -v preview | grep -v rc | grep -v display))
            fi
            rm ./${version}.json
          done
          $(echo ${sdks[@]} | tr ' ' '\n' | cut -d\" -f2 | sort -r | uniq -w 5)